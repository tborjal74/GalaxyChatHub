datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}


model User {
  id        Int        @id @default(autoincrement())
  username  String     @unique
  email     String     @unique
  password  String
  firstName String?
  lastName  String?
  bio       String?    @db.VarChar(500)
  avatarUrl String?
  status    UserStatus @default(OFFLINE)
  createdAt DateTime   @default(now())

  // Relations
  messages        Message[]
  roomMembers     RoomMember[]
  sentFriendReqs  Friend[] @relation("sentRequests")
  receivedReqs    Friend[] @relation("receivedRequests")
  sentDMs         DirectMessage[] @relation("sentDMs")
  receivedDMs     DirectMessage[] @relation("receivedDMs")
}

model Room {
  id        Int      @id @default(autoincrement())
  name      String
  isPrivate Boolean  @default(false)
  createdAt DateTime @default(now())

  members   RoomMember[]
  messages  Message[]
}

model RoomMember {
  id     Int @id @default(autoincrement())
  userId Int
  roomId Int

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  room Room @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@unique([userId, roomId])
}

model Message {
  id        Int      @id @default(autoincrement())
  content   String
  createdAt DateTime @default(now())

  userId Int
  roomId Int

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  room Room @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model Friend {
  id Int @id @default(autoincrement())

  senderId   Int
  receiverId Int
  status     FriendStatus @default(PENDING)
  createdAt  DateTime     @default(now())

  sender   User @relation("sentRequests", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("receivedRequests", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId])
}

model DirectMessage {
  id        Int      @id @default(autoincrement())
  content   String
  createdAt DateTime @default(now())

  senderId   Int
  receiverId Int

  sender   User @relation("sentDMs", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("receivedDMs", fields: [receiverId], references: [id], onDelete: Cascade)
}

enum FriendStatus {
  PENDING
  ACCEPTED
  BLOCKED
}

enum UserStatus {
  ONLINE
  OFFLINE
  BUSY
  AWAY
}
